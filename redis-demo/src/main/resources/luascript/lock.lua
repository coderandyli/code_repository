---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by lizhen.
--- DateTime: 2019-07-15 11:58
---
local lockKey = KEYS[1]
local lockValue = KEYS[2]
local currentTime = KEYS[3]

-- setnx info
local result_1 = redis.call('SETNX', lockKey, lockValue)
if result_1 == true
then
    return result_1
else
    local currentValue = redis.call('GET', lockKey)
    if tonumber(currentValue) < tonumber(currentTime)
    then
        local oldValue = redis.call("GETSET", lockKey, lockValue)
        if oldValue == currentValue
        then
            return true
        end
    end
end

